<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formulário de Currículo Moderno</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ======= mantém seu design (cores, animações, tipografia) ======= */
    :root{
      --bg-light:#f8f9fa; --text-light:#212529;
      --accent-light:#28a745; --accent-light-hover:#218838;
      --focus-ring-light:#dc3545; --error-light:#dc3545; --success-light:#28a745;
      --border-light:#dee2e6; --shadow-light:rgba(0,0,0,.08);
      --input-bg-light:#fff; --input-text-light:#495057;
      --card-bg-light:#fff; --legend-text-light:#6c757d;

      --bg-dark:#1a1a1a; --text-dark:#e9ecef;
      --accent-dark:#34c759; --accent-dark-hover:#2ca34c;
      --focus-ring-dark:#ff4d4d; --error-dark:#ff4d4d; --success-dark:#34c759;
      --border-dark:#495057; --shadow-dark:rgba(255,255,255,.1);
      --input-bg-dark:#2c2c2c; --input-text-dark:#ced4da; --card-bg-dark:#252525; --legend-text-dark:#adb5bd;

      --bg:var(--bg-light); --text:var(--text-light); --accent:var(--accent-light);
      --accent-hover:var(--accent-light-hover); --focus-ring:var(--focus-ring-light);
      --error-color:var(--error-light); --success-color:var(--success-light);
      --border:var(--border-light); --shadow:var(--shadow-light);
      --input-bg:var(--input-bg-light); --input-text:var(--input-text-light);
      --card-bg:var(--card-bg-light); --legend-text:var(--legend-text-light);
      --transition-speed:.3s;
    }
    [data-theme='dark']{
      --bg:var(--bg-dark); --text:var(--text-dark); --accent:var(--accent-dark);
      --accent-hover:var(--accent-dark-hover); --focus-ring:var(--focus-ring-dark);
      --error-color:var(--error-dark); --success-color:var(--success-dark);
      --border:var(--border-dark); --shadow:var(--shadow-dark);
      --input-bg:var(--input-bg-dark); --input-text:var(--input-text-dark);
      --card-bg:var(--card-bg-dark); --legend-text:var(--legend-text-dark);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;padding:2rem;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;transition:background-color var(--transition-speed),color var(--transition-speed)}
    .form-container{width:100%;max-width:700px;margin:2rem 0}
    form{background:var(--card-bg);padding:2.5rem;border-radius:16px;box-shadow:0 8px 25px var(--shadow);animation:fadeInUp .8s ease-out;transition:background-color var(--transition-speed),box-shadow var(--transition-speed)}
    h2{text-align:center;color:var(--accent);margin-bottom:.5rem;font-weight:600;font-size:1.8rem;transition:color var(--transition-speed)}
    .form-description{text-align:center;color:var(--text);opacity:.8;margin-bottom:2.5rem;font-size:.95rem;transition:color var(--transition-speed)}
    fieldset{border:none;margin-bottom:2rem;padding:0}
    legend{font-size:1.1rem;font-weight:600;color:var(--legend-text);margin-bottom:1.5rem;padding-bottom:.5rem;border-bottom:1px solid var(--border);width:100%;transition:color var(--transition-speed),border-color var(--transition-speed)}
    .form-group{margin-bottom:1.5rem}
    label{display:block;margin-bottom:.5rem;font-weight:500;font-size:.9rem;color:var(--text);transition:color var(--transition-speed)}
    input[type="text"],input[type="email"],input[type="file"],select{width:100%;padding:.8rem 1rem;margin-top:.25rem;border:1px solid var(--border);border-radius:8px;background:var(--input-bg);color:var(--input-text);font-size:.95rem;transition:border-color var(--transition-speed),box-shadow var(--transition-speed),background-color var(--transition-speed),color var(--transition-speed);outline:none}
    input::placeholder,select::placeholder{color:var(--input-text);opacity:.7}
    input:focus,select:focus{border-color:var(--focus-ring);box-shadow:0 0 0 3px color-mix(in srgb,var(--focus-ring) 30%,transparent)}
    input[type="file"]{padding:.5rem 1rem}
    input[type="file"]::file-selector-button{margin-right:1rem;border:none;background:var(--accent);padding:.6rem 1rem;border-radius:6px;color:#fff;cursor:pointer;transition:background-color var(--transition-speed);font-weight:500}
    input[type="file"]::file-selector-button:hover{background:var(--accent-hover)}
    button[type="submit"]{background:var(--accent);color:#fff;padding:.9rem 1.5rem;margin-top:1.5rem;width:100%;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:background-color var(--transition-speed),transform .1s,box-shadow var(--transition-speed);display:flex;justify-content:center;align-items:center;gap:.5rem;box-shadow:0 4px 10px color-mix(in srgb,var(--accent) 30%,transparent)}
    button[type="submit"]:hover:not(:disabled){background:var(--accent-hover);transform:translateY(-2px);box-shadow:0 6px 15px color-mix(in srgb,var(--accent) 40%,transparent)}
    button[type="submit"]:active:not(:disabled){transform:translateY(0);box-shadow:0 4px 10px color-mix(in srgb,var(--accent) 30%,transparent)}
    button[type="submit"]:disabled{background:#ccc;cursor:not-allowed;opacity:.7;box-shadow:none}
    .spinner{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite}
    .message{display:none;margin-top:1.5rem;padding:1rem;border-radius:8px;text-align:center;font-weight:500;animation:fadeIn .5s ease-out}
    .message.success{background:color-mix(in srgb,var(--success-color) 15%,transparent);color:var(--success-color);border:1px solid color-mix(in srgb,var(--success-color) 30%,transparent)}
    .message.error{background:color-mix(in srgb,var(--error-color) 15%,transparent);color:var(--error-color);border:1px solid color-mix(in srgb,var(--error-color) 30%,transparent)}
    .hidden{display:none!important}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media (max-width:768px){
      body{padding:1rem}.form-container{margin:1rem 0}form{padding:1.5rem}h2{font-size:1.5rem}.form-description{font-size:.9rem;margin-bottom:2rem}
      legend{font-size:1rem;margin-bottom:1rem}.form-group{margin-bottom:1rem}
      label{font-size:.85rem}
      input[type="text"],input[type="email"],input[type="file"],select,button[type="submit"]{font-size:.9rem;padding:.7rem .9rem}
      input[type="file"]::file-selector-button{padding:.5rem .8rem}
    }
    /* barra de progresso discreta para wake */
    .wakebar{height:3px;width:0;background:linear-gradient(90deg,#28a745,#dc3545);border-radius:999px;transition:width .2s}
  </style>
</head>
<body data-theme="light">
  <div class="form-container">
    <form id="formCurriculo" novalidate>
      <div class="wakebar" id="wakebar" aria-hidden="true"></div>

      <h2>Envie o seu Currículo</h2>
      <p class="form-description">Preencha os campos abaixo para se candidatar às nossas vagas.</p>

      <fieldset>
        <legend>Informações Pessoais</legend>
        <div class="form-group">
          <label for="nome">Nome Completo:</label>
          <input type="text" id="nome" name="nome" required placeholder="Digite seu nome completo">
        </div>
        <div class="form-group">
          <label for="cpf">CPF:</label>
          <input type="text" id="cpf" name="cpf" required placeholder="000.000.000-00">
        </div>
        <div class="form-group">
          <label for="telefone">Telefone:</label>
          <input type="text" id="telefone" name="telefone" required placeholder="(00) 00000-0000">
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" id="email" name="email" required placeholder="seuemail@exemplo.com">
        </div>
      </fieldset>

      <fieldset>
        <legend>Endereço</legend>
        <div class="form-group">
          <label for="cep">CEP:</label>
          <input type="text" id="cep" name="cep" required placeholder="00000-000">
        </div>
        <div class="form-group">
          <label for="cidade">Cidade:</label>
          <input type="text" id="cidade" name="cidade" required placeholder="Sua cidade">
        </div>
        <div class="form-group">
          <label for="bairro">Bairro:</label>
          <input type="text" id="bairro" name="bairro" required placeholder="Seu bairro">
        </div>
        <div class="form-group">
          <label for="rua">Rua:</label>
          <input type="text" id="rua" name="rua" required placeholder="Nome da sua rua">
        </div>
      </fieldset>

      <fieldset>
        <legend>Candidatura</legend>
        <div class="form-group">
          <label for="transporte">Possui Transporte Próprio?</label>
          <select id="transporte" name="transporte" required>
            <option value="" disabled selected>Selecione...</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </div>
        <div class="form-group">
          <label for="vaga">Vaga Desejada:</label>
          <select id="vaga" name="vaga" required>
            <option value="" disabled selected>Selecione a vaga...</option>
            <option>AUXILIAR DE PADEIRO</option>
            <option>AUXILIAR DE LIMPEZA</option>
            <option>AUXILIAR DE T.I</option>
            <option>AUXILIAR ADMINISTRATIVO</option>
            <option>BALCONISTA DE AÇOUGUE</option>
            <option>BALCONISTA DE PADARIA</option>
            <option>EMBALADOR (A)</option>
            <option>REPOSITOR (A)</option>
            <option>OPERADOR (A) DE CAIXA</option>
            <option>OPERADOR DE SUPERMERCADO</option>
            <option>AUX. DE PREVENÇÃO E PERDA</option>
          </select>
        </div>
        <div class="form-group">
          <label for="arquivo">Anexar Currículo (PDF/DOC/DOCX):</label>
          <input type="file" id="arquivo" name="arquivo" accept=".pdf,.doc,.docx" required>
        </div>
      </fieldset>

      <button type="submit" id="submitButton">
        <span class="button-text">Enviar Candidatura</span>
        <span class="spinner hidden"></span>
      </button>

      <div class="message success hidden" id="mensagemSucesso"></div>
      <div class="message error hidden" id="mensagemErro"></div>
    </form>
  </div>

  <script src="https://unpkg.com/imask"></script>
  <script>
    // ====== CONFIG ======
    const API_BASE = "https://formulariobk.onrender.com";
    const FILE_MAX_MB = 5;
    const WAKE_MS = 30000;

    // ====== DOM ======
    const form = document.getElementById("formCurriculo");
    const nome = document.getElementById("nome");
    const cpf = document.getElementById("cpf");
    const telefone = document.getElementById("telefone");
    const email = document.getElementById("email");
    const cep = document.getElementById("cep");
    const cidade = document.getElementById("cidade");
    const bairro = document.getElementById("bairro");
    const rua = document.getElementById("rua");
    const transporte = document.getElementById("transporte");
    const vaga = document.getElementById("vaga");
    const arquivo = document.getElementById("arquivo");
    const btn = document.getElementById("submitButton");
    const btnText = btn.querySelector(".button-text");
    const spinner = btn.querySelector(".spinner");
    const okBox = document.getElementById("mensagemSucesso");
    const errBox = document.getElementById("mensagemErro");
    const wakebar = document.getElementById("wakebar");

    // ====== Máscaras ======
    IMask(cpf, { mask: "000.000.000-00" });
    IMask(cep, { mask: "00000-000" });
    IMask(telefone, { mask: [{mask:"(00) 0000-0000"}, {mask:"(00) 00000-0000"}] });

    // ====== ViaCEP (debounce) ======
    let cepTimer;
    cep.addEventListener("input", ()=>{
      clearTimeout(cepTimer);
      cepTimer = setTimeout(async ()=>{
        const v = cep.value.replace(/\D/g,"");
        if(v.length !== 8) return;
        try{
          const r = await fetch(`https://viacep.com.br/ws/${v}/json/`, { cache:"no-store" });
          if(!r.ok) return;
          const d = await r.json();
          if(!d?.erro){
            cidade.value = d.localidade || "";
            bairro.value = d.bairro || "";
            rua.value = d.logradouro || "";
          }
        }catch{}
      }, 500);
    });

    function showMsg(el, msg){
      el.textContent = msg;
      el.classList.remove("hidden");
      el.style.display = "block";
      // esconde a outra
      if(el === okBox){ errBox.classList.add("hidden"); errBox.style.display="none"; }
      else { okBox.classList.add("hidden"); okBox.style.display="none"; }
    }
    function hideMsgs(){
      [okBox, errBox].forEach(e => { e.classList.add("hidden"); e.style.display="none"; });
    }
    function setLoading(v){
      if(v){ btnText.classList.add("hidden"); spinner.classList.remove("hidden"); btn.disabled = true; }
      else { btnText.classList.remove("hidden"); spinner.classList.add("hidden"); btn.disabled = false; }
    }
    function validateFile(){
      const f = arquivo.files?.[0];
      if(!f){ showMsg(errBox, "Selecione um arquivo."); return false; }
      const ok = ["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];
      if(!ok.includes(f.type)){ showMsg(errBox, "Formato inválido. Envie PDF, DOC ou DOCX."); return false; }
      if(f.size > FILE_MAX_MB*1024*1024){ showMsg(errBox, `Arquivo muito grande. Máximo ${FILE_MAX_MB} MB.`); return false; }
      return true;
    }
    function orderedFD(){
      const out = new FormData();
      out.append("nome", nome.value);
      out.append("cpf", cpf.value);
      out.append("telefone", telefone.value);
      out.append("email", email.value);
      out.append("cep", cep.value);
      out.append("cidade", cidade.value);
      out.append("bairro", bairro.value);
      out.append("rua", rua.value);
      out.append("transporte", transporte.value);
      out.append("vaga", vaga.value);
      out.append("arquivo", arquivo.files[0]);
      out.append("data", new Date().toISOString());
      return out;
    }
    async function fetchWithTimeout(url, opts={}, ms=30000){
      const ctrl = new AbortController(); const t = setTimeout(()=>ctrl.abort(), ms);
      try{ return await fetch(url, { ...opts, signal: ctrl.signal, cache:"no-store" }); }
      finally{ clearTimeout(t); }
    }
    function animateWake(ms){
      wakebar.style.width = "0%";
      const start = performance.now();
      const step = (now)=>{
        const p = Math.min(1, (now - start)/ms);
        wakebar.style.width = (p*100).toFixed(1) + "%";
        if(p<1) requestAnimationFrame(step);
      };
      requestAnimationFrame(step);
    }
    async function preWake(){
      animateWake(WAKE_MS);
      const start = Date.now();
      while(Date.now() - start < WAKE_MS){
        try{ const r = await fetchWithTimeout(`${API_BASE}/health`, {}, 5000); if(r.ok){ wakebar.style.width="100%"; return true; } }catch{}
        await new Promise(r => setTimeout(r, 3000));
      }
      return false;
    }

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      hideMsgs();
      if(!validateFile()) return;

      setLoading(true);

      // acorda o Render (até 30s)
      const woke = await preWake();
      if(!woke){ setLoading(false); showMsg(errBox,"Estamos processando sua solicitação. Por favor, aguarde alguns instantes até que sua candidatura seja enviada."); return; }

      // Envia
      let resp, data = {};
      try{
        resp = await fetchWithTimeout(`${API_BASE}/api/enviar`, { method:"POST", body: orderedFD() }, 60000);
        try{ data = await resp.json(); }catch{}
      }catch{
        setLoading(false);
        showMsg(errBox,"Falha de rede ao enviar. Tente novamente.");
        return;
      }

      setLoading(false);

      if(resp.status === 409){
        showMsg(errBox, data?.message || "Identificamos que já existe uma candidatura registrada para esta vaga com o mesmo CPF. Aguarde o período estabelecido antes de reenviar");
        return;
      }
      if(!resp.ok){
        const txt = data?.message || (await resp.text().catch(()=>null)) || "Não foi possível enviar sua candidatura.";
        showMsg(errBox, txt);
        return;
      }

      showMsg(okBox, data?.message || "Sua candidatura foi enviada com sucesso. Agradecemos seu interesse e entraremos em contato caso seu perfil seja selecionado.");
      form.reset();
      wakebar.style.width = "0%";
    });
  </script>
</body>
</html>
